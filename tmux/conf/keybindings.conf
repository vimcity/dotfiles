# ============================================================================
# Tmux Keybindings
# ============================================================================

# ----------------------------------------------------------------------------
# Unbind Default Keys (to avoid conflicts)
# ----------------------------------------------------------------------------
unbind %
unbind '"'
unbind c
unbind n
unbind p
unbind l
unbind s
unbind v
unbind w
unbind x
unbind &
unbind ,
unbind .
unbind -
unbind =
unbind ?
unbind :
unbind !
unbind d
unbind r
unbind R
unbind S
unbind Space
unbind z
unbind N
unbind L
unbind h
unbind j
unbind k
unbind [
unbind y


# ----------------------------------------------------------------------------
# Pane Resizing
# ----------------------------------------------------------------------------

bind -r C-Left resize-pane -L 4
bind -r C-Down resize-pane -D 4
bind -r C-Up resize-pane -U 4
bind -r C-Right resize-pane -R 4

# ----------------------------------------------------------------------------
# Window Management
# ----------------------------------------------------------------------------
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind c new-window -c "#{pane_current_path}"
bind x kill-pane
bind w kill-window
bind J join-pane -s :+1
bind T display-popup -w 70% -h 70% 
# ----------------------------------------------------------------------------
# Window Navigation
# ----------------------------------------------------------------------------
# Number-based selection
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9
bind 0 select-window -l

# Next/Previous/Last
bind n new-session
bind l last-window
bind-key -n M-h previous-window
bind-key -n M-l next-window

# ----------------------------------------------------------------------------
# Window Reordering
# ----------------------------------------------------------------------------
# Shift current window left/right in the window list
bind -r '{' swap-window -t -1 -d  # Move window left (Prefix + {)
bind -r '}' swap-window -t +1 -d  # Move window right (Prefix + })

# Move window to specific position (prompts for target index)
bind M command-prompt -p "Move window to index:" "move-window -t '%%'"

# Swap with another window (prompts for target)
bind W command-prompt -p "Swap with window:" "swap-window -t '%%'"

# ----------------------------------------------------------------------------
# Session Management
# ----------------------------------------------------------------------------
bind d detach-client
bind r source-file ~/.tmux.conf
bind R command-prompt -I "#W" "rename-window '%%'; set-window-option automatic-rename off"
bind S command-prompt -I "#S" "rename-session '%%'"

# ----------------------------------------------------------------------------
# Copy Mode (Vim-like)
bind b copy-mode
bind y send-keys -X copy-selection

# Copy mode vi bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Custom 'g' sequences in copy mode
bind-key -T copy-mode-g 'h' send -X start-of-line \; switch-client -T copy-mode-vi
bind-key -T copy-mode-g 'l' send -X end-of-line \; switch-client -T copy-mode-vi
bind-key -T copy-mode-vi 'g' switch-client -T copy-mode-g

# ----------------------------------------------------------------------------
# Layout Management
# ----------------------------------------------------------------------------
bind Space next-layout
bind z resize-pane -Z

# ----------------------------------------------------------------------------
# Utility Bindings
# ----------------------------------------------------------------------------
bind : command-prompt
bind ! break-pane
bind & kill-window
bind - delete-buffer
bind = choose-buffer
bind K list-keys

# ----------------------------------------------------------------------------
# Plugin Keybindings
# ----------------------------------------------------------------------------
# Session/Window chooser
bind C-s choose-tree -Zs
bind C-f choose-tree -Zw

# Resurrect save/restore
bind C-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'
bind C-l run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'

# Thumbs (quick selection)
bind t run-shell -b "~/.tmux/plugins/tmux-thumbs/tmux-thumbs.sh"

# FZF URL opener
bind u run-shell -b "~/.tmux/plugins/tmux-fzf-url/scripts/open.sh"

# Pomodoro Timer
bind p run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh toggle"
bind P run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh cancel"
bind \< run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh skip"
bind \> run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh restart"
bind C-p run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh menu"
bind M-p run-shell -b "~/.tmux/plugins/tmux-pomodoro-plus/scripts/pomodoro.sh custom"

# ----------------------------------------------------------------------------
# Vim-Tmux Navigator Integration
# ----------------------------------------------------------------------------
# Smart pane switching with awareness of vim splits (Ctrl+h/j/k/l)
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n C-h if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n C-j if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n C-k if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n C-l if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -n C-\\ if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'

# ----------------------------------------------------------------------------
# Cheat.sh Integration
# ----------------------------------------------------------------------------
bind-key -r i neww -n "cht.sh" ~/dotfiles/bin/tmux-cht
