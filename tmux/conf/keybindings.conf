# ============================================================================
# Tmux Keybindings
# ============================================================================

# ----------------------------------------------------------------------------
# Unbind Default Keys (to avoid conflicts)
# ----------------------------------------------------------------------------
unbind %
unbind '"'
unbind c
unbind n
unbind p
unbind l
unbind s
unbind v
unbind w
unbind x
unbind &
unbind ,
unbind .
unbind -
unbind =
unbind ?
unbind :
unbind !
unbind d
unbind r
unbind R
unbind S
unbind Space
unbind z
unbind N
unbind L
unbind h
unbind j
unbind k
unbind [
unbind y

# ----------------------------------------------------------------------------
# Pane Navigation (Vim-like: h/j/k/l)
# ----------------------------------------------------------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ----------------------------------------------------------------------------
# Pane Resizing
# ----------------------------------------------------------------------------
# Coarse adjustments (capital letters, 5-unit jumps)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Fine adjustments (Ctrl + arrows, 1-unit)
bind -r C-Left resize-pane -L 1
bind -r C-Down resize-pane -D 1
bind -r C-Up resize-pane -U 1
bind -r C-Right resize-pane -R 1

# ----------------------------------------------------------------------------
# Window Management
# ----------------------------------------------------------------------------
bind v split-window -h -c "#{pane_current_path}"
bind s split-window -v -c "#{pane_current_path}"
bind c new-window
bind x kill-pane
bind w kill-window

# ----------------------------------------------------------------------------
# Window Navigation
# ----------------------------------------------------------------------------
# Number-based selection
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9
bind 0 select-window -l

# Next/Previous/Last
bind n next-window
bind N previous-window
bind L last-window
bind-key -n M-h previous-window
bind-key -n M-l next-window

# ----------------------------------------------------------------------------
# Session Management
# ----------------------------------------------------------------------------
bind d detach-client
bind r source-file ~/.tmux.conf
bind R command-prompt -I "#W" "rename-window '%%'"
bind S command-prompt -I "#S" "rename-session '%%'"

# ----------------------------------------------------------------------------
# Copy Mode (Vim-like)
# ----------------------------------------------------------------------------
bind [ copy-mode
bind y send-keys -X copy-selection
bind p paste-buffer

# Copy mode vi bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Custom 'g' sequences in copy mode
bind-key -T copy-mode-g 'h' send -X start-of-line \; switch-client -T copy-mode-vi
bind-key -T copy-mode-g 'l' send -X end-of-line \; switch-client -T copy-mode-vi
bind-key -T copy-mode-vi 'g' switch-client -T copy-mode-g

# ----------------------------------------------------------------------------
# Layout Management
# ----------------------------------------------------------------------------
bind Space next-layout
bind z resize-pane -Z

# ----------------------------------------------------------------------------
# Utility Bindings
# ----------------------------------------------------------------------------
bind : command-prompt
bind ! break-pane
bind & kill-window
bind - delete-buffer
bind = choose-buffer
bind K list-keys

# ----------------------------------------------------------------------------
# Plugin Keybindings
# ----------------------------------------------------------------------------
# Session/Window chooser
bind C-s choose-tree -Zs
bind C-f choose-tree -Zw

# Resurrect save/restore
bind C-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'
bind C-l run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'

# Thumbs (quick selection)
bind t run-shell -b "~/.tmux/plugins/tmux-thumbs/tmux-thumbs.sh"

# FZF URL opener
bind u run-shell -b "~/.tmux/plugins/tmux-fzf-url/scripts/open.sh"

# ----------------------------------------------------------------------------
# Vim-Tmux Navigator Integration
# ----------------------------------------------------------------------------
# Smart pane switching with awareness of vim splits (Ctrl+h/j/k/l)
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n C-h if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n C-j if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n C-k if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n C-l if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -n C-\\ if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
