# Portability Analysis Report

**Date:** January 13, 2025  
**Status:** NEEDS FIXES  
**Priority:** MEDIUM  

## Executive Summary

Your dotfiles are **mostly portable** but have several issues that would prevent a new user from using them cleanly. The main problems are:

1. ‚ùå **install.sh tries to symlink non-existent directories**
2. ‚ùå **Hardcoded tmux keybind documentation (wrong prefix key)**
3. ‚ùå **Assumed directory structures** (~/Projects, ~/Documents)
4. ‚ö†Ô∏è  **Some macOS-specific commented code**

**Overall Portability Score:** 6/10 (needs improvements)

---

## Issues Found

### 1. Non-Existent Directory References in install.sh (CRITICAL)

**Issue:** The install script tries to symlink directories that don't exist in the repository.

**Affected Lines:**
```bash
ln -sf "$HOME/dotfiles/bat" "$HOME/.config/bat"          # Line 81
ln -sf "$HOME/dotfiles/neofetch" "$HOME/.config/neofetch" # Line 83
ln -sf "$HOME/dotfiles/hammerspoon" "$HOME/.hammerspoon"  # Line 84
```

**Current Status:**
- ‚úó `./bat` - DOES NOT EXIST
- ‚úó `./neofetch` - DOES NOT EXIST
- ‚úó `./hammerspoon` - DOES NOT EXIST

**Impact:** When a new user runs `./install.sh`, these symlink commands will create dead symlinks pointing to non-existent directories. While the `-f` flag prevents errors, this causes silent failures.

**Fix:**
Option A: Remove these lines if they're not used
Option B: Create these directories with default configs
Option C: Add conditional checks before symlinking

**Recommended:** Remove them since bat/neofetch/hammerspoon are tool-specific and users may not need them.

---

### 2. Wrong Tmux Prefix Key in Documentation (CRITICAL)

**Issue:** install.sh documents incorrect keybind for tmux plugins

**Location:** install.sh, lines 101-102
```bash
echo "üîå To install Tmux plugins:"
echo "   1. Start tmux: tmux"
echo "   2. Press: Ctrl+a then I (capital i)"    # ‚ùå WRONG!
```

**Problem:** Your tmux config uses `Ctrl+Space` as prefix (in tmux/conf/settings.conf), but the installation guide says `Ctrl+a`.

**Impact:** New users will be confused and unable to install tmux plugins correctly.

**Fix:** Change "Ctrl+a" to "Ctrl+Space" (or use the actual prefix variable from config)

---

### 3. Assumed Directory Structure (HIGH PRIORITY)

**Issue:** Code assumes directories exist that may not on other machines

**Locations:**

a) **zshrc, line 90:**
```bash
alias neo="z ~/Projects && nvim"
```
Not everyone has a `~/Projects` directory.

b) **zshrc, lines 193-195:**
```bash
alias desk='cd ~/Desktop'
alias docs='cd ~/Documents'
alias down='cd ~/Downloads'
```
These are macOS-standard directories but may not exist on Linux.

c) **nvim/lua/plugins/orgmode.lua, lines 8 & 148:**
```lua
local org_path = vim.fn.expand(os.getenv("ORG_PATH") or "~/Documents")
```
Assumes `~/Documents` exists if `ORG_PATH` isn't set.

**Impact:** Users following these aliases on different systems or different directory layouts will get errors like "directory not found".

**Fix:** 
- Make aliases conditional (check if directory exists)
- Or provide clear instructions for users to customize
- Or use XDG Base Directory standard

---

### 4. Missing `.config` Directory Creation (MEDIUM PRIORITY)

**Issue:** install.sh doesn't ensure `$HOME/.config` exists before creating symlinks

**Location:** install.sh, lines 79-88

**Current Code:**
```bash
ln -sf "$HOME/dotfiles/ghostty" "$HOME/.config/ghostty"
```

**Problem:** If `$HOME/.config` doesn't exist (on Linux or custom setups), these symlinks will fail.

**Impact:** Install will silently fail on systems without `.config` directory.

**Fix:** Add directory creation before symlinking:
```bash
mkdir -p "$HOME/.config"
```

---

### 5. Hardcoded FZF Path (.fzf.zsh)

**Issue:** `.fzf.zsh` contains hardcoded Homebrew path

**Location:** .fzf.zsh, line 4
```bash
PATH="${PATH:+${PATH}:}/opt/homebrew/opt/fzf/bin"
```

**Note:** This is actually auto-generated by fzf, so it's not critical, but be aware it's macOS/Homebrew specific.

**Impact:** On Linux or with different package managers, this path doesn't exist (but it's safe because it just checks PATH).

---

### 6. Markdown Plugin Disabled on macOS (MEDIUM PRIORITY)

**Issue:** Markdown plugin has macOS-specific comment

**Location:** nvim/lua/plugins/markdown.lua, line 4
```lua
enabled = false, -- Disabled due to macOS code signing issues with treesitter parsers
```

**Problem:** This is disabled for everyone, but the reason is macOS-specific. Users on Linux might want this plugin enabled.

**Impact:** Linux users lose markdown plugin functionality unnecessarily.

**Fix:** Make this conditional based on OS detection, or document why it's disabled.

---

## Portability Strengths ‚úÖ

**Good practices already in place:**

1. ‚úÖ **$HOME variable usage:** Most paths correctly use `$HOME` instead of hardcoded `/Users/rgaur`
2. ‚úÖ **Symlink strategy:** Uses flexible `$HOME/dotfiles` path that works anywhere
3. ‚úÖ **XDG Base Directory:** Uses `$HOME/.config` for tool configs (portable standard)
4. ‚úÖ **Machine-specific isolation:** `~/.zshrc.local` for user customization
5. ‚úÖ **Git ignore:** Properly ignores machine-specific files
6. ‚úÖ **Environment variables:** Uses env vars for configuration (ORG_PATH, PERSONAL)
7. ‚úÖ **Modular structure:** Each tool is in its own directory
8. ‚úÖ **Public URLs:** install.sh uses only public GitHub repositories

---

## Recommended Fixes (Priority Order)

### Priority 1: CRITICAL (Do First)

**Fix #1: Remove non-existent directory symlinks**

Edit `install.sh` and remove or conditionally add:
```bash
# DELETE THESE LINES (or make conditional):
ln -sf "$HOME/dotfiles/bat" "$HOME/.config/bat"
ln -sf "$HOME/dotfiles/neofetch" "$HOME/.config/neofetch"
ln -sf "$HOME/dotfiles/hammerspoon" "$HOME/.hammerspoon"
```

**Reason:** These directories don't exist and create dead symlinks.

**Fix #2: Correct tmux prefix in install.sh**

Edit line 102:
```bash
# BEFORE:
echo "   2. Press: Ctrl+a then I (capital i)"

# AFTER:
echo "   2. Press: Ctrl+Space then I (capital i)"
```

**Reason:** Your config uses Ctrl+Space, not Ctrl+a.

### Priority 2: HIGH (Do Second)

**Fix #3: Make directory aliases conditional**

Edit `zshrc` lines 90, 193-195:
```bash
# BEFORE:
alias neo="z ~/Projects && nvim"
alias desk='cd ~/Desktop'
alias docs='cd ~/Documents'
alias down='cd ~/Downloads'

# AFTER:
alias neo="z ~/Projects 2>/dev/null && nvim || nvim"  # or use $XDG_PROJECTS_DIR
[ -d ~/Desktop ] && alias desk='cd ~/Desktop' || alias desk='echo "~/Desktop not found"'
[ -d ~/Documents ] && alias docs='cd ~/Documents' || alias docs='echo "~/Documents not found"'
[ -d ~/Downloads ] && alias down='cd ~/Downloads' || alias down='echo "~/Downloads not found"'
```

**Reason:** Not all systems have these standard macOS directories.

**Fix #4: Ensure .config directory exists**

Edit `install.sh`, add before line 79:
```bash
# Create .config directory if it doesn't exist
mkdir -p "$HOME/.config"
```

**Reason:** Some Linux systems may not have this directory by default.

### Priority 3: MEDIUM (Nice to Have)

**Fix #5: Make markdown plugin conditional on OS**

Edit `nvim/lua/plugins/markdown.lua`:
```lua
-- BEFORE:
enabled = false, -- Disabled due to macOS code signing issues with treesitter parsers

-- AFTER:
enabled = vim.fn.has("mac") == 0,  -- Disabled on macOS only, enabled on Linux
```

**Reason:** Let Linux users benefit from markdown features.

**Fix #6: Document ORG_PATH setup**

The orgmode.lua already supports `ORG_PATH` env var, which is good. Consider documenting this in README:
```bash
# Set custom org path (add to ~/.zshrc.local):
export ORG_PATH="$HOME/path/to/org/files"
```

---

## Step-by-Step Portability Improvement Guide

### For Fix #1: Remove Non-Existent Symlinks

```bash
# Open install.sh and locate these lines (around 79-88):
ln -sf "$HOME/dotfiles/bat" "$HOME/.config/bat"
ln -sf "$HOME/dotfiles/neofetch" "$HOME/.config/neofetch"
ln -sf "$HOME/dotfiles/hammerspoon" "$HOME/.hammerspoon"

# DELETE or COMMENT OUT these three lines
# Reason: These directories don't exist in the repo
```

### For Fix #2: Correct Tmux Prefix

```bash
# In install.sh, line 102:
# Change this:
echo "   2. Press: Ctrl+a then I (capital i)"

# To this:
echo "   2. Press: Ctrl+Space then I (capital i)"
```

### For Fix #3: Make Aliases Conditional

```bash
# In zshrc, lines 90 and 193-195:

# BEFORE:
alias neo="z ~/Projects && nvim"

# AFTER (better):
# Only create alias if directory exists, otherwise provide helpful error
if [ -d ~/Projects ]; then
    alias neo="z ~/Projects && nvim"
else
    alias neo="echo 'Create ~/Projects directory or set a different path' && nvim"
fi
```

### For Fix #4: Ensure .config Exists

```bash
# In install.sh, before line 79, add:
mkdir -p "$HOME/.config"
```

---

## Testing Portability After Fixes

After making these fixes, test portability with:

```bash
# Simulate fresh install:
cd ~
rm -rf ~/dotfiles-test  # Clean up old test
git clone <your-repo> ~/dotfiles-test
cd ~/dotfiles-test
bash -n install.sh  # Syntax check
# Review output for any references to missing directories
```

---

## Final Portability Checklist

After applying fixes:

- [ ] No non-existent directory symlinks
- [ ] Correct tmux prefix documentation (Ctrl+Space)
- [ ] Directory aliases are conditional or documented
- [ ] .config directory is created before use
- [ ] Markdown plugin conditional on OS
- [ ] ORG_PATH documented for customization
- [ ] All paths use $HOME or environment variables
- [ ] No hardcoded usernames in configs
- [ ] install.sh syntax valid (bash -n)
- [ ] install.sh runs without creating dead symlinks

---

## Portability Score

**Current:** 6/10
- ‚ùå Critical issues with non-existent directories
- ‚ùå Wrong documentation for tmux prefix
- ‚ö†Ô∏è Assumed directory structures
- ‚úÖ Good use of environment variables
- ‚úÖ Modular structure
- ‚úÖ XDG standard compliance

**After Fixes:** 9/10
- ‚úÖ All non-existent symlinks removed
- ‚úÖ Correct documentation
- ‚úÖ Conditional directory aliases
- ‚úÖ Full portability across systems
- ‚úÖ Clear customization points

---

## Conclusion

Your dotfiles are **almost ready for sharing** but need these fixes to be truly portable:

1. Remove the 3 non-existent symlinks
2. Fix the tmux prefix documentation
3. Make directory aliases conditional
4. Ensure .config directory exists

**Estimated fix time:** 5-10 minutes

After these changes, anyone can clone your repo and run `./install.sh` without issues, on macOS or Linux! üéâ
