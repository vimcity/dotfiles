#Enable status bar at the top
set -g status on

# Enable mouse support
set -g mouse on

# Set escape time to 0 for better key detection
set -g escape-time 0

# Enable extended keys for better Option key support
set -g extended-keys on

# Terminal settings
set-option -g default-terminal 'screen-256color'
set-option -g terminal-overrides ',xterm-256color:RGB'

unbind C-b
unbind C-a
set -g prefix C-Space
bind C-Space send-prefix

# Catppuccin theme configuration
set -g @plugin 'catppuccin/tmux'
set -g @catppuccin_flavor 'mocha'
set -g @catppuccin_window_status_style "rounded"

# Catppuccin theme customizations
set -g @catppuccin_window_left_separator ""
set -g @catppuccin_window_right_separator " "
set -g @catppuccin_window_middle_separator " █"
set -g @catppuccin_window_number_position "right"
set -g @catppuccin_window_default_fill "number"
set -g @catppuccin_window_default_text "#W"
set -g @catppuccin_window_current_fill "number"
set -g @catppuccin_window_current_text "#W#{?window_zoomed_flag,(),}"
set -g @catppuccin_status_modules_right "directory date_time"
set -g @catppuccin_status_modules_left "session"
set -g @catppuccin_status_left_separator  ""
set -g @catppuccin_status_right_separator ""
set -g @catppuccin_status_right_separator_inverse "no"
set -g @catppuccin_status_fill "icon"
set -g @catppuccin_status_connect_separator "no"
set -g @catppuccin_directory_text "#{b:pane_current_path}"
set -g @catppuccin_date_time_text "%H:%M"
# TPM plugin manager/
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'

# Session management
set -g @plugin 'tmux-plugins/tmux-sessionist'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Copy/paste and productivity
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'fcsonline/tmux-thumbs'
set -g @plugin 'wfxr/tmux-fzf-url'

# Status bar enhancements
set -g @plugin 'tmux-plugins/tmux-battery'
set -g @plugin 'tmux-plugins/tmux-cpu'

# Plugin configurations
# Resurrect settings
set -g @resurrect-save 'S'
set -g @resurrect-restore 'R'
set -g @resurrect-dir '~/.tmux/resurrect'

# Continuum settings
set -g @continuum-save-interval '15'
set -g @continuum-restore 'on'

# Yank settings
set -g @yank_selection 'primary'
set -g @yank_selection_mouse 'clipboard'

# Battery settings
set -g @batt_icon_charge_tier8 ' '
set -g @batt_icon_charge_tier7 ' '
set -g @batt_icon_charge_tier6 ' '
set -g @batt_icon_charge_tier5 ' '
set -g @batt_icon_charge_tier4 ' '
set -g @batt_icon_charge_tier3 ' '
set -g @batt_icon_charge_tier2 ' '
set -g @batt_icon_charge_tier1 ' '

# FZF URL plugin settings
set -g @fzf-url-fzf-options '-p 60%,30% --prompt="  " --border-label=" Open URL "'
set -g @fzf-url-history-limit '2000'

# Resurrect strategy for nvim
set -g @resurrect-strategy-nvim 'session'

run '~/.tmux/plugins/tpm/tpm'

# Start window numbering at 1
set -g base-index 1

# Start pane numbering at 1
setw -g pane-base-index 1

# Enable vi mode for copy mode
setw -g mode-keys vi

# Additional useful settings
set -g detach-on-destroy off     # don't exit from tmux when closing a session
set -g history-limit 1000000     # increase history size (from 2,000)
set -g renumber-windows on       # renumber all windows when any window is closed
set -g set-clipboard on          # use system clipboard
set -g status-position top       # macOS / darwin style
set -g pane-active-border-style 'fg=magenta,bg=default'
set -g pane-border-style 'fg=brightblack,bg=default'

# Unbind default keys to avoid conflicts
unbind %
unbind '"'
unbind c
unbind n
unbind p
unbind l
unbind s
unbind v
unbind w
unbind x
unbind &
unbind ,
unbind .
unbind -
unbind =
unbind ?
unbind :
unbind !
unbind d
unbind r
unbind R
unbind S
unbind Space
unbind z
unbind N
unbind L
unbind h
unbind j
unbind k
unbind [
unbind y

# Vim-like pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Window splitting (intuitive)
bind v split-window -h
bind s split-window -v
bind c new-window
bind x kill-pane
bind w kill-window

# Window navigation (number-based)
bind 1 select-window -t :1
bind 2 select-window -t :2
bind 3 select-window -t :3
bind 4 select-window -t :4
bind 5 select-window -t :5
bind 6 select-window -t :6
bind 7 select-window -t :7
bind 8 select-window -t :8
bind 9 select-window -t :9
bind 0 select-window -l # This will select window 0 (if it exists) or you can change to last window

# Session management
bind d detach-client
bind r source-file ~/.tmux.conf
bind R command-prompt -I "#W" "rename-window '%%'"
bind S command-prompt -I "#S" "rename-session '%%'"

# Copy mode (vim-like)
bind [ copy-mode
bind y send-keys -X copy-selection
bind p paste-buffer

# Better copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
bind -T copy-mode-vi r send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Layout management
bind Space next-layout
bind z resize-pane -Z

# Client management
bind n next-window
bind N previous-window
bind L last-window

# Utility
bind : command-prompt
bind ! break-pane
bind & kill-window
bind - delete-buffer
bind = choose-buffer
bind K list-keys

# Plugin key bindings
# Session management
bind C-s choose-tree -Zs
bind C-f choose-tree -Zw

# Resurrect (save/restore sessions)
bind C-r run-shell '~/.tmux/plugins/tmux-resurrect/scripts/save.sh'
bind C-l run-shell '~/.tmux/plugins/tmux-resurrect/scripts/restore.sh'

# Copycat (search)
bind / copy-mode \; send-keys -X search-backward
bind ? copy-mode \; send-keys -X search-forward

# Thumbs (quick selection)
bind t run-shell -b "~/.tmux/plugins/tmux-thumbs/tmux-thumbs.sh"

# FZF URL (open URLs)
bind u run-shell -b "~/.tmux/plugins/tmux-fzf-url/scripts/open.sh"

# vim-tmux-navigator configuration
# Smart pane switching with awareness of vim splits (Ctrl+h/j/k/l)
is_vim="ps -o state= -o comm= -t '#{pane_tty}' | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n C-h if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n C-j if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n C-k if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n C-l if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'
bind-key -n C-\\ if-shell "$is_vim" 'send-keys C-\\' 'select-pane -l'
